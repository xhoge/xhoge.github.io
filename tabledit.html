<!DOCTYPE html>
<html>
<head>
  <title>IndexedDBへのテーブルデータの格納</title>
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache">
  <link rel="stylesheet" href="css/style.css?v001">
  <script src="./script/script.js?v001"></script>
  <style>
    .content{
        margin-left:200px;
    }
  </style>
</head>
<body>
    <div id="sidebar"></div>
    <div class="content">
        <table id="myTable">
            <thead>
              <tr>
                <th data-keyname="column1">Column 1</th>
                <th data-keyname="column2">Column 2</th>
                <th data-keyname="column3">Column 3</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td data-keyname="column1">Data 1-1</td>
                <td data-keyname="column2">Data 1-2</td>
                <td data-keyname="column3">Data 1-3</td>
              </tr>
              <tr>
                <td data-keyname="column1">Data 2-1</td>
                <td data-keyname="column2">Data 2-2</td>
                <td data-keyname="column3">Data 2-3</td>
              </tr>
              <tr>
                <td data-keyname="column1">Data 3-1</td>
                <td data-keyname="column2">Data 3-2</td>
                <td data-keyname="column3">Data 3-3</td>
              </tr>
            </tbody>
          </table>
        
          <button onclick="updateTableToIndexedDB()">更新</button>
    </div>
<script>
    createSidebar();
  // テーブルの更新ボタンがクリックされたときの処理
function updateTableToIndexedDB() {
  // IndexedDBのデータベース名とオブジェクトストア名
  const dbName = "myDatabase";
  const storeName = "myTable";

  // テーブル要素の取得
  const table = document.getElementById("myTable");

  // IndexedDBのオープン
  const request = indexedDB.open(dbName);

  request.onerror = function(event) {
    console.error("IndexedDBのオープンに失敗しました");
  };

  request.onsuccess = function(event) {
    const db = event.target.result;

    // トランザクションの開始
    const transaction = db.transaction(storeName, "readwrite");
    const store = transaction.objectStore(storeName);

    // テーブルの行を走査してデータをIndexedDBに格納
    const rows = table.getElementsByTagName("tr");
    for (let i = 0; i < rows.length; i++) {
      const row = rows[i];
      const rowData = {};

      // カラムのデータ属性を取得してキーと値をセット
      const cells = row.getElementsByTagName("td");
      for (let j = 0; j < cells.length; j++) {
        const cell = cells[j];
        const key = cell.getAttribute("data-keyname");
        const value = cell.textContent;
        rowData[key] = value;
      }

      // IndexedDBにデータを追加
      const addRequest = store.add(rowData);
      addRequest.onerror = function(event) {
        console.error("データの追加に失敗しました");
      };
    }

    transaction.oncomplete = function() {
      console.log("データの追加が完了しました");
    };

    transaction.onerror = function(event) {
      console.error("トランザクション中にエラーが発生しました");
    };

    // トランザクションの終了とデータベースのクローズ
    transaction.oncomplete = function() {
      db.close();
    };
  };

  request.onupgradeneeded = function(event) {
    const db = event.target.result;

    // オブジェクトストアの作成
    if (!db.objectStoreNames.contains(storeName)) {
      db.createObjectStore(storeName, { keyPath: "id", autoIncrement: true });
    }
  };
}
  </script>

</body>
</html>